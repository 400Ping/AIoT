{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">違規事件列表</h2>

{% if current_user.is_authenticated and current_user.is_admin %}
  <div class="mb-3 d-flex gap-2">
    <a href="{{ url_for('admin_new_event') }}" class="btn btn-success btn-sm">
      新增事件
    </a>
    <form method="post" action="{{ url_for('admin_clear_events') }}"
          onsubmit="return confirm('確定要清空所有事件？此操作無法復原');">
      <button type="submit" class="btn btn-danger btn-sm">
        清空所有事件
      </button>
    </form>
  </div>
{% endif %}

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>時間</th>
        <th>攝影機</th>
        <th>狀態</th>
        <th>人數</th>
        <th>未戴帽</th>
        <th>截圖</th>
        {% if current_user.is_authenticated and current_user.is_admin %}
          <th>操作</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for e in events %}
      <tr>
        <td>{{ e.id }}</td>
        <td>{{ e.timestamp }}</td>
        <td>{{ e.camera_id or '-' }}</td>
        <td>
          {% if e.status == 'unsafe' %}
            <span class="badge bg-danger">Unsafe</span>
          {% else %}
            <span class="badge bg-success">Safe</span>
          {% endif %}
        </td>
        <td>{{ e.num_people }}</td>
        <td>{{ e.num_no_helmet }}</td>
        <td>
          {% if e.image_url %}
            <a href="{{ e.image_url }}" target="_blank">
              <img src="{{ e.image_url }}" class="img-thumbnail" style="max-width: 120px;">
            </a>
          {% else %}
            -
          {% endif %}
        </td>
        {% if current_user.is_authenticated and current_user.is_admin %}
          <td>
            <form method="post"
                  action="{{ url_for('admin_delete_event', event_id=e.id) }}"
                  onsubmit="return confirm('確定要刪除這筆事件嗎？');">
              <button type="submit" class="btn btn-outline-danger btn-sm">
                刪除
              </button>
            </form>
          </td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
